import{l as e,T as t}from"./main-CCMahuXD.js";const n={SS:100,S:80,A:60,B:40,C:20};function s(e,t){let n=0;const s=[],o=[],a=e.entity,c=a.name;if(t.character){const o=t.character?.synergies_items??[],a=t.character?.synergies_weapons??[];"item"===e.type&&o.some(e=>e.length>=3&&(e.toLowerCase().includes(c.toLowerCase())||c.toLowerCase().includes(e.toLowerCase())))&&(n+=20,s.push(`Synergizes with ${t.character.name}`)),"weapon"===e.type&&a.some(e=>e.length>=3&&(e.toLowerCase().includes(c.toLowerCase())||c.toLowerCase().includes(e.toLowerCase())))&&(n+=20,s.push(`Great synergy with ${t.character.name}`))}if(t.weapon&&"item"===e.type){const e=a,o=[...e?.synergies??[],...e?.synergies_weapons??[]],c=t.weapon;o.some(e=>e.length>=3&&(e.toLowerCase()===c.name.toLowerCase()||e.toLowerCase().includes(c.name.toLowerCase())||c.name.toLowerCase().includes(e.toLowerCase())))&&(n+=15,s.push(`Synergizes with ${c.name}`))}for(const i of t.items){const e=a;(e?.synergies??[]).some(e=>e.length>=3&&(e.toLowerCase().includes(i.name.toLowerCase())||i.name.toLowerCase().includes(e.toLowerCase())))&&(n+=10,s.push(`Synergizes with ${i.name}`));(e?.anti_synergies??e?.antiSynergies??[]).some(e=>e.length>=3&&(e.toLowerCase().includes(i.name.toLowerCase())||i.name.toLowerCase().includes(e.toLowerCase())))&&(n-=30,o.push(`Anti-synergy with ${i.name}`))}return{score:n,synergies:s,antiSynergies:o}}function o(e,t){if("item"!==e.type)return{penalty:0};const n=e.entity;if(n.one_and_done){if(t.items.some(e=>e.id===n.id))return{penalty:100,reason:"ONE-AND-DONE item already in build"}}if(!1===n.stacks_well){if(t.items.some(e=>e.id===n.id))return{penalty:50,reason:"Item does not stack well"}}const s=n.base_effect?.toLowerCase()||"";let o=0;for(const c of t.items){const e=c.base_effect?.toLowerCase()||"";(s.includes("damage")&&e.includes("damage")||s.includes("crit")&&e.includes("crit")||s.includes("hp")&&e.includes("hp"))&&o++}const a=Math.min(10*o,40);return a>0?{penalty:a,reason:`Already have ${o} similar items`}:{penalty:0}}function a(e,t){if("mixed"===t.type||t.strength<.3)return{bonus:0};const n=e.entity,s=n.name?.toLowerCase()||"",o=n.base_effect?.toLowerCase()||"";let a=!1,c="";switch(t.type){case"damage":(s.includes("damage")||o.includes("damage")||s.includes("gym"))&&(a=!0,c="Fits damage build archetype");break;case"tank":(s.includes("hp")||s.includes("health")||o.includes("hp")||s.includes("beefy"))&&(a=!0,c="Fits tank build archetype");break;case"crit":(s.includes("crit")||o.includes("crit")||s.includes("juice")||s.includes("fork"))&&(a=!0,c="Fits crit build archetype");break;case"proc":(s.includes("proc")||s.includes("chance")||o.includes("chance")||s.includes("bonk"))&&(a=!0,c="Fits proc-based build archetype");break;case"speed":(s.includes("speed")||s.includes("attack speed")||o.includes("attack speed"))&&(a=!0,c="Fits speed build archetype")}if(a){return{bonus:15*t.strength,reason:c}}return{bonus:0}}let c={},i={character:null,weapon:null,items:[],tomes:[]},r=new Map,d=new Map;function l(t){c=t;const n=document.getElementById("advisor-character");n&&t.characters?.characters&&t.characters.characters.forEach(e=>{const t=document.createElement("option");t.value=e.id,t.textContent=e.name,n.appendChild(t)});const s=document.getElementById("advisor-weapon");s&&t.weapons?.weapons&&t.weapons.weapons.forEach(e=>{const t=document.createElement("option");t.value=e.id,t.textContent=e.name,s.appendChild(t)}),function(){const e=document.getElementById("advisor-character");e?.addEventListener("change",u);const t=document.getElementById("advisor-weapon");t?.addEventListener("change",h);const n=document.getElementById("add-current-item");n?.addEventListener("click",()=>p("item"));const s=document.getElementById("add-current-tome");s?.addEventListener("click",()=>p("tome"));for(let a=1;a<=3;a++){const e=document.getElementById(`choice-${a}-type`);e?.addEventListener("change",e=>f(a,e.target.value))}const o=document.getElementById("get-recommendation");o?.addEventListener("click",v)}(),e.info({operation:"advisor.init",data:{charactersCount:t.characters?.characters.length||0,weaponsCount:t.weapons?.weapons.length||0,itemsCount:t.items?.items.length||0}})}function m(t){if(t.character){i.character=t.character;const e=document.getElementById("advisor-character");e&&(e.value=t.character.id)}if(t.weapon){i.weapon=t.weapon;const e=document.getElementById("advisor-weapon");e&&(e.value=t.weapon.id)}t.items&&t.items.length>0&&(r.clear(),t.items.forEach(e=>{r.set(e.id,e)}),i.items=t.items),t.tomes&&t.tomes.length>0&&(d.clear(),t.tomes.forEach(e=>{d.set(e.id,e)}),i.tomes=t.tomes),g(),e.info({operation:"advisor.scanned_build_applied",data:{character:t.character?.name,weapon:t.weapon?.name,itemsCount:t.items?.length||0,tomesCount:t.tomes?.length||0}})}function u(t){const n=t.target.value;if(!n)return void(i.character=null);const s=c.characters?.characters.find(e=>e.id===n);s&&(i.character=s,e.info({operation:"advisor.character_selected",data:{character:s.name}}))}function h(t){const n=t.target.value;if(!n)return void(i.weapon=null);const s=c.weapons?.weapons.find(e=>e.id===n);s&&(i.weapon=s,e.info({operation:"advisor.weapon_selected",data:{weapon:s.name}}))}function p(e){const n="item"===e?c.items?.items:c.tomes?.tomes;if(!n)return;const s=document.createElement("div");s.className="modal advisor-entity-modal",s.style.display="block";const o=document.createElement("div");o.className="modal-content";const a=document.createElement("button");a.className="close",a.innerHTML="&times;",a.onclick=()=>s.remove();const l=document.createElement("h3");l.textContent="Select "+("item"===e?"Item":"Tome");const m=document.createElement("div");m.className="advisor-entity-list",n.forEach(n=>{const o=document.createElement("button");o.className="advisor-entity-card",o.innerHTML=`\n            <div class="entity-name">${n.name}</div>\n            <div class="entity-tier">${n.tier}</div>\n        `,o.onclick=()=>{!function(e,n){if("item"===e){const e=n;r.set(e.id,e),i.items=Array.from(r.values())}else{const e=n;d.set(e.id,e),i.tomes=Array.from(d.values())}g(),t.success(`Added ${n.name}`)}(e,n),s.remove()},m.appendChild(o)}),o.appendChild(a),o.appendChild(l),o.appendChild(m),s.appendChild(o),document.body.appendChild(s),s.addEventListener("click",e=>{e.target===s&&s.remove()})}function g(){const e=document.getElementById("advisor-current-items");if(e){e.innerHTML="",r.forEach(t=>{const n=y(t,()=>{r.delete(t.id),i.items=Array.from(r.values()),g()});e.appendChild(n)});const t=document.createElement("button");t.className="advisor-add-btn",t.textContent="+ Add Item",t.onclick=()=>p("item"),e.appendChild(t)}const t=document.getElementById("advisor-current-tomes");if(t){t.innerHTML="",d.forEach(e=>{const n=y(e,()=>{d.delete(e.id),i.tomes=Array.from(d.values()),g()});t.appendChild(n)});const e=document.createElement("button");e.className="advisor-add-btn",e.textContent="+ Add Tome",e.onclick=()=>p("tome"),t.appendChild(e)}}function y(e,t){const n=document.createElement("div");n.className="advisor-chip",n.innerHTML=`\n        <span class="chip-name">${e.name}</span>\n        <button class="chip-remove" aria-label="Remove ${e.name}">&times;</button>\n    `;return n.querySelector(".chip-remove").onclick=t,n}function f(e,t){const n=document.getElementById(`choice-${e}-entity`);if(!n)return;if(n.innerHTML='<option value="">Select...</option>',!t)return;let s=[];switch(t){case"item":s=c.items?.items||[];break;case"weapon":s=c.weapons?.weapons||[];break;case"tome":s=c.tomes?.tomes||[];break;case"shrine":s=c.shrines?.shrines||[]}s.forEach(e=>{const t=document.createElement("option");t.value=e.id,t.textContent=`${e.name} (${e.tier})`,n.appendChild(t)})}function v(){try{const r=[];for(let e=1;e<=3;e++){const n=document.getElementById(`choice-${e}-type`),s=document.getElementById(`choice-${e}-entity`),o=n?.value,a=s?.value;if(!o||!a){if(e<=2)return void t.error("Please select at least 2 choices");continue}let i;switch(o){case"item":i=c.items?.items.find(e=>e.id===a);break;case"weapon":i=c.weapons?.weapons.find(e=>e.id===a);break;case"tome":i=c.tomes?.tomes.find(e=>e.id===a);break;case"shrine":i=c.shrines?.shrines.find(e=>e.id===a)}i&&r.push({type:o,entity:i})}if(r.length<2)return void t.error("Please select at least 2 choices to compare");const d=function(e,t){const c=[],i=function(e){let t=0,n=0,s=0,o=0,a=0;for(const l of e.items){const e=l.name?.toLowerCase()||"",c=l.base_effect?.toLowerCase()||"",i=l.description?.toLowerCase()||"";(e.includes("damage")||c.includes("damage")||i.includes("damage"))&&t++,(e.includes("hp")||e.includes("health")||c.includes("hp")||e.includes("beefy"))&&n++,(e.includes("crit")||c.includes("crit")||e.includes("juice")||e.includes("fork"))&&s++,(e.includes("proc")||e.includes("chance")||e.includes("bonk")||e.includes("meatball"))&&o++,(e.includes("speed")||e.includes("attack speed")||c.includes("attack speed"))&&a++}for(const l of e.tomes){const e=l.stat_affected?.toLowerCase()||"";e.includes("damage")&&(t+=2),(e.includes("health")||e.includes("hp"))&&(n+=2),e.includes("crit")&&(s+=2),(e.includes("attack speed")||e.includes("cooldown"))&&(a+=2)}const c=t+n+s+o+a;if(0===c)return{type:"mixed",strength:0};const i=[{type:"damage",count:t},{type:"tank",count:n},{type:"crit",count:s},{type:"proc",count:o},{type:"speed",count:a}];if(i.sort((e,t)=>t.count-e.count),0===i.length)return{type:"mixed",strength:0};const r=i[0],d=r.count/c;return d<.3?{type:"mixed",strength:.5}:{type:r.type,strength:d}}(e);for(const r of t){const t=r.entity;let d=0;const l=[],m=[],u=n[t.tier];d+=u,l.push(`${t.tier}-tier item (${u} base score)`);const{score:h,synergies:p,antiSynergies:g}=s(r,e);d+=h,p.length>0&&l.push(`${p.length} synergies detected`),g.length>0&&m.push(...g);const{penalty:y,reason:f}=o(r,e);d-=y,f&&m.push(f);const{bonus:v,reason:w}=a(r,i);d+=v,w&&l.push(w),e.items.length<3&&"SS"===t.tier&&(d+=10,l.push("Early game - prioritize strong items"));const C=Math.min(.2*p.length+(0===g.length?.3:0)+.5,1);c.push({choice:r,score:Math.max(0,d),confidence:C,reasoning:l,warnings:m,synergies:p,antiSynergies:g})}return c.sort((e,t)=>t.score-e.score),c}(i,r);!function(e){const t=document.getElementById("advisor-results"),n=document.getElementById("advisor-results-content");if(!t||!n)return;if(n.innerHTML="",0===e.length)return n.innerHTML="<p>No recommendations available.</p>",void(t.style.display="block");e.forEach((e,t)=>{const s=document.createElement("div");s.className="advisor-result-card "+(0===t?"top-recommendation":"");const o=e.choice.entity,a=t+1;let c=`\n            <div class="result-header">\n                <div class="result-rank">${1===a?"üéØ":2===a?"ü•à":"ü•â"} ${1===a?"RECOMMENDED":`#${a}`}</div>\n                <div class="result-title">${o.name}</div>\n                <div class="result-tier tier-${o.tier.toLowerCase()}">${o.tier}</div>\n            </div>\n            <div class="result-score">\n                <strong>Score:</strong> ${Math.round(e.score)} |\n                <strong>Confidence:</strong> ${Math.round(100*e.confidence)}%\n            </div>\n        `;e.reasoning.length>0&&(c+='<div class="result-section"><strong>Why?</strong><ul>',e.reasoning.forEach(e=>{c+=`<li>‚úì ${e}</li>`}),c+="</ul></div>"),e.synergies.length>0&&(c+='<div class="result-section"><strong>Synergies:</strong><ul>',e.synergies.forEach(e=>{c+=`<li class="synergy">‚Ä¢ ${e}</li>`}),c+="</ul></div>"),e.warnings.length>0&&(c+='<div class="result-section warnings"><strong>Warnings:</strong><ul>',e.warnings.forEach(e=>{c+=`<li class="warning">‚ö†Ô∏è ${e}</li>`}),c+="</ul></div>"),s.innerHTML=c,n.appendChild(s)}),t.style.display="block",t.scrollIntoView({behavior:"smooth",block:"start"})}(d),e.info({operation:"advisor.recommendation_generated",data:{choicesCount:r.length,topChoice:d[0]?.choice.entity.name}})}catch(r){e.error({operation:"advisor.recommendation_error",error:{name:r.name,message:r.message,module:"advisor"}}),t.error("Failed to generate recommendation. Please try again.")}}function w(){i={character:null,weapon:null,items:[],tomes:[]},r.clear(),d.clear();const e=document.getElementById("advisor-character"),t=document.getElementById("advisor-weapon");e&&(e.value=""),t&&(t.value=""),g();for(let s=1;s<=3;s++){const e=document.getElementById(`choice-${s}-type`),t=document.getElementById(`choice-${s}-entity`);e&&(e.value=""),t&&(t.value="")}const n=document.getElementById("advisor-results");n&&(n.style.display="none")}window.initAdvisor=l,window.applyScannedBuild=m;export{m as applyScannedBuild,l as initAdvisor,w as resetAdvisor};
//# sourceMappingURL=advisor-Bu-J6_4E.js.map
