import{D as e,I as t,e as a,a as i,b as n,B as o,j as s,h as r,T as c,l as d,s as l,g as m,y as u}from"./main-BWYXOf-Y.js";let p="",h=null;function v(){p="",h=null}function f(a,i=!0){if(i){const e=function(e){return[e.character?.id||"",e.weapon?.id||"",e.tomes.map(e=>e.id).sort().join(","),e.items.map(e=>e.id).sort().join(",")].join("|")}(a);if(e===p&&h)return h;p=e}const n={...e,evasion:0,overcrit:!1};if(a.character){const e=a.character.passive_ability||"";!function(e,t){const a=t.toLowerCase();/crit(ical)?\s*chance/i.test(a)&&(e.crit_chance+=50),/max\s*hp|hp\s*per\s*level/i.test(a)&&(e.hp+=50),/armor/i.test(a)&&(e.armor+=50),/gain.*\d+(\.\d+)?%?\s*damage/i.test(a)&&!/crit(ical)?\s*damage/i.test(a)&&(e.damage+=20),/attack\s*speed/i.test(a)&&(e.attack_speed+=50),/move(ment)?\s*speed/i.test(a)&&(e.movement_speed+=20),/crit(ical)?\s*damage/i.test(a)&&(e.crit_damage+=25)}(n,e)}if(a.weapon){const e=a.weapon.base_damage??a.weapon.baseDamage,t=null!=e?parseFloat(String(e)):0;n.damage+=Number.isFinite(t)?t:0}a.tomes.forEach(e=>function(e,t){const a=t.value_per_level||"",i=String(a).match(/[+-]?\d+(?:\.\d+)?/),n=i?parseFloat(i[0]):0,o=Number.isFinite(n)?Math.max(-1e3,Math.min(1e3,n)):0,s=o<1&&o>0?100*o:o;"Damage"===t.stat_affected?e.damage+=5*s:"Critical Chance"===t.stat_affected||"precision"===t.id?e.crit_chance+=5*s:"Crit Damage"===t.stat_affected?e.crit_damage+=5*s:"Max HP"===t.stat_affected||"vitality"===t.id||"hp"===t.id?e.hp+=5*s:"Attack Speed"===t.stat_affected||"cooldown"===t.id?e.attack_speed+=5*s:"Movement Speed"===t.stat_affected||"agility"===t.id?e.movement_speed+=5*s:"Armor"!==t.stat_affected&&"armor"!==t.id||(e.armor+=5*s)}(n,e)),a.items.forEach(e=>function(e,a){const i=t[a.id];if(i){const t=i.stat;"add"===i.type?e[t]+=i.value:"multiply"===i.type?e[t]*=i.value:"hp_percent"===i.type&&(e[t]+=e.hp/100*i.value)}}(n,e));const o=Math.max(n.evasion_internal,-99);return n.evasion=Math.round(o/(1+o/100)*100)/100,n.overcrit=n.crit_chance>100,i&&(h=n),n}function g(){!function(){const e=i("build-character");if(e&&(e.innerHTML='<option value="">Select Character...</option>',n.characters?.characters)){const t=document.createDocumentFragment();n.characters.characters.forEach(e=>{const a=document.createElement("option");a.value=e.id,a.textContent=`${e.name} (${e.tier} Tier)`,t.appendChild(a)}),e.appendChild(t)}}(),function(){const e=i("build-weapon");if(e&&(e.innerHTML='<option value="">Select Weapon...</option>',n.weapons?.weapons)){const t=document.createDocumentFragment();n.weapons.weapons.forEach(e=>{const a=document.createElement("option");a.value=e.id,a.textContent=`${e.name} (${e.tier} Tier)`,t.appendChild(a)}),e.appendChild(t)}}(),function(){const e=i("tomes-selection");if(e&&(e.innerHTML="",n.tomes?.tomes)){const t=document.createDocumentFragment();n.tomes.tomes.forEach(e=>{const i=document.createElement("label");i.innerHTML=`<input type="checkbox" value="${a(e.id)}" class="tome-checkbox"> ${a(e.name)}`,t.appendChild(i)}),e.appendChild(t)}}(),function(){const e=i("items-selection");if(e&&(e.innerHTML="",n.items?.items)){const t=document.createDocumentFragment();n.items.items.slice(0,o).forEach(e=>{const i=document.createElement("label");i.innerHTML=`<input type="checkbox" value="${a(e.id)}" class="item-checkbox"> ${a(e.name)} (${a(e.tier)})`,t.appendChild(i)}),e.appendChild(t)}}()}function w(e,t){if(e.character&&e.weapon){!function(e){const t=i("build-stats");t&&(t.innerHTML=`\n        <div class="stat-card"><div class="stat-icon">‚öîÔ∏è</div><div class="stat-info"><div class="stat-label">Total Damage</div><div class="stat-value">${e.damage.toFixed(0)}%</div></div></div>\n        <div class="stat-card"><div class="stat-icon">‚ù§Ô∏è</div><div class="stat-info"><div class="stat-label">Max HP</div><div class="stat-value">${e.hp.toFixed(0)}</div></div></div>\n        <div class="stat-card ${e.overcrit?"stat-overcrit":""}"><div class="stat-icon">üí•</div><div class="stat-info"><div class="stat-label">Crit Chance${e.overcrit?" (OVERCRIT!)":""}</div><div class="stat-value">${e.crit_chance.toFixed(1)}%</div></div></div>\n        <div class="stat-card"><div class="stat-icon">üéØ</div><div class="stat-info"><div class="stat-label">Crit Damage</div><div class="stat-value">${e.crit_damage.toFixed(0)}%</div></div></div>\n        <div class="stat-card"><div class="stat-icon">‚ö°</div><div class="stat-info"><div class="stat-label">Attack Speed</div><div class="stat-value">${e.attack_speed.toFixed(0)}%</div></div></div>\n        <div class="stat-card"><div class="stat-icon">üëü</div><div class="stat-info"><div class="stat-label">Movement Speed</div><div class="stat-value">${e.movement_speed.toFixed(0)}%</div></div></div>\n        <div class="stat-card"><div class="stat-icon">üõ°Ô∏è</div><div class="stat-info"><div class="stat-label">Armor</div><div class="stat-value">${e.armor.toFixed(0)}</div></div></div>\n        <div class="stat-card"><div class="stat-icon">üí®</div><div class="stat-info"><div class="stat-label">Evasion</div><div class="stat-value">${e.evasion.toFixed(1)}%</div></div></div>\n        <div class="stat-card"><div class="stat-icon">üéØ</div><div class="stat-info"><div class="stat-label">Projectiles</div><div class="stat-value">${e.projectiles}</div></div></div>\n    `)}(f(e))}else!function(){const e=i("build-stats");e&&(e.innerHTML='<p class="stats-placeholder">Select character and weapon to see calculated stats...</p>')}();const n=function(e){const t=[];var i,n;return e.character&&e.weapon&&(i=e.character,n=e.weapon,i.synergies_weapons?.includes(n.name)&&t.push(`‚úì ${a(e.character.name)} synergizes with ${a(e.weapon.name)}!`)),e.weapon&&e.items.forEach(i=>{(function(e,t){const a=e.synergies||[],i=t.name.toLowerCase();return a.some(e=>e.length>0&&i.length>0&&(e.toLowerCase().includes(i)||i.includes(e.toLowerCase())))})(i,e.weapon)&&t.push(`‚úì ${a(i.name)} works great with ${a(e.weapon.name)}`)}),{found:t.length>0,messages:t}}(e);!function(e){const t=i("build-synergies");t&&(t.innerHTML=e.length>0?`<h4>üîó Synergies Found:</h4><ul>${e.map(e=>`<li>${e}</li>`).join("")}</ul>`:"<p>Select character, weapon, and items to see synergies...</p>")}(n.messages),t&&t()}function b(e){s("build-character",e)}function y(e){s("build-weapon",e)}function _(e){const t=document.querySelectorAll(".tome-checkbox"),a=new Map;t.forEach(e=>a.set(e.value,e)),e.forEach(e=>{const t=a.get(e);t&&(t.checked=!0)})}function k(e){const t=document.querySelectorAll(".item-checkbox"),a=new Map;t.forEach(e=>a.set(e.value,e)),e.forEach(e=>{const t=a.get(e);t&&(t.checked=!0)})}async function $(e,t){try{return await navigator.clipboard.writeText(e),c.success(t),!0}catch(a){const e=a;return c.error(`Failed to copy to clipboard: ${e.message}`),!1}}function x(e){return f(e||m("currentBuild"))}const C=Object.freeze({crit_build:{name:"üéØ Crit Build",description:"Maximize critical hit chance and damage",build:{character:"cl4nk",weapon:"revolver",tomes:["precision","damage"],items:["clover","eagle_claw"]}},tank_build:{name:"üõ°Ô∏è Tank Build",description:"High HP and survivability",build:{character:"sir_oofie",weapon:"sword",tomes:["hp","armor"],items:["chonkplate","golden_shield"]}},speed_build:{name:"‚ö° Speed Build",description:"Fast attack and movement speed",build:{character:"bandit",weapon:"katana",tomes:["cooldown","agility"],items:["turbo_skates","turbo_socks"]}},glass_cannon:{name:"üí• Glass Cannon",description:"Maximum damage, low defense",build:{character:"ogre",weapon:"sniper_rifle",tomes:["damage","cooldown"],items:["power_gloves","gym_sauce"]}}}),S="megabonk_build_history";let B=!1;function M(){return m("currentBuild")}const E=new Proxy({},{get:(e,t)=>M()[t],set(e,t,a){const i={...M()};return i[t]=a,l("currentBuild",i),!0}});function A(){try{const e=localStorage.getItem(S);if(!e)return[];const t=JSON.parse(e);return Array.isArray(t)?t.filter((e,t)=>!!function(e){if("object"!=typeof e||null===e)return!1;const t=e;return!(void 0!==t.tomes&&!Array.isArray(t.tomes)||void 0!==t.items&&!Array.isArray(t.items))}(e)||(d.warn({operation:"build.history",error:{name:"ValidationError",message:`Skipping corrupted entry at index ${t}`}}),!1)):(d.warn({operation:"build.history",error:{name:"ValidationError",message:"Build history is not an array"}}),[])}catch(e){return d.warn({operation:"build.history",error:{name:e.name,message:e.message}}),[]}}function F(){if(E.character||E.weapon)try{let e=A();const t={name:E.name||`Build ${(new Date).toLocaleString()}`,notes:E.notes||"",timestamp:Date.now(),character:E.character?.id,weapon:E.weapon?.id,tomes:(E.tomes||[]).map(e=>e.id),items:(E.items||[]).map(e=>e.id)};e.unshift(t),e=e.slice(0,u),localStorage.setItem(S,JSON.stringify(e)),d.info({operation:"build.save",data:{action:"save_to_history",characterId:E.character?.id,weaponId:E.weapon?.id,tomesCount:E.tomes?.length??0,itemsCount:E.items?.length??0,historySize:e.length}}),c.success(`Build "${t.name}" saved to history!`)}catch{c.error("Failed to save build to history")}else c.warning("Build must have at least a character or weapon")}function I(e){try{if(!Number.isFinite(e)||!Number.isInteger(e))return void c.error("Invalid build index");const t=A();if(e<0||e>=t.length)return void c.error("Build not found in history");const a=t[e];if(!a)return void c.error("Build not found in history");N(a),d.info({operation:"build.load",data:{action:"load_from_history",source:"history",historyIndex:e,characterId:a.character,weaponId:a.weapon}}),c.success(`Loaded "${a.name||"Build"}" from history`)}catch{c.error("Failed to load build from history")}}function L(e){try{if(!Number.isFinite(e)||!Number.isInteger(e))return void c.error("Invalid build index");let t=A();if(e<0||e>=t.length)return void c.error("Build not found in history");const a=t[e]?.name||"Build";t.splice(e,1),localStorage.setItem(S,JSON.stringify(t)),c.success(`Deleted "${a}" from history`);const i=window;"function"==typeof i.showBuildHistoryModal&&i.showBuildHistoryModal()}catch{c.error("Failed to delete build from history")}}function T(){try{localStorage.removeItem(S),c.success("Build history cleared")}catch{c.error("Failed to clear build history")}}function H(e){const t=C[e];if(t)try{E.name=t.name,E.notes=t.description,N(t.build),c.success(`Loaded template: ${t.name}`)}catch{c.error("Failed to load template")}else c.error("Template not found")}function N(e){if(U(),e.character&&n.characters?.characters){const t=new Map(n.characters.characters.map(e=>[e.id,e])).get(e.character);t&&(E.character=t,b(t.id))}if(e.weapon&&n.weapons?.weapons){const t=new Map(n.weapons.weapons.map(e=>[e.id,e])).get(e.weapon);t&&(E.weapon=t,y(t.id))}e.tomes&&Array.isArray(e.tomes)&&n.tomes?.tomes&&_(e.tomes),e.items&&Array.isArray(e.items)&&n.items?.items&&k(e.items),e.name&&(E.name=e.name),e.notes&&(E.notes=e.notes),R()}function D(e){try{N(JSON.parse(e)),c.success("Build imported successfully!")}catch{c.error("Invalid build data. Please check the format.")}}function j(e){N({character:e.character?.id||"",weapon:e.weapon?.id||"",tomes:e.tomes.map(e=>e.id),items:e.items.map(e=>e.id),name:"Random Build",notes:"Generated by Random Build Generator"}),c.success("Random build applied!")}function O(){B||(J(),B=!0),g()}function J(){!function(e,t,a,n,o){const s=i("build-character");s&&s.addEventListener("change",t=>{const a=t.target;e(a.value)});const r=i("build-weapon");r&&r.addEventListener("change",e=>{const a=e.target;t(a.value)});const c=i("export-build");c&&c.addEventListener("click",a);const d=i("share-build-url");d&&d.addEventListener("click",n);const l=i("clear-build");l&&l.addEventListener("click",o)}(e=>{const t=n.characters?.characters;E.character=t&&t.find(t=>t.id===e)||null,R()},e=>{const t=n.weapons?.weapons;E.weapon=t&&t.find(t=>t.id===e)||null,R()},P,z,U),function(e){const t=i("tomes-selection");t&&t.addEventListener("change",e);const a=i("items-selection");a&&a.addEventListener("change",e)}(R)}function R(){const e=Array.from(r(".tome-checkbox:checked")).map(e=>e.value);if(n.tomes?.tomes){const t=new Map(n.tomes.tomes.map(e=>[e.id,e]));E.tomes=e.map(e=>t.get(e)).filter(e=>void 0!==e)}else E.tomes=[];const t=Array.from(r(".item-checkbox:checked")).map(e=>e.value);if(n.items?.items){const e=new Map(n.items.items.map(e=>[e.id,e]));E.items=t.map(t=>e.get(t)).filter(e=>void 0!==e)}else E.items=[];l("currentBuild",{...E}),w(M(),G)}function P(){$(JSON.stringify({character:E.character?.id,weapon:E.weapon?.id,tomes:E.tomes.map(e=>e.id),items:E.items.map(e=>e.id)}),"Build code copied to clipboard!")}function z(){const e={c:E.character?.id,w:E.weapon?.id,t:E.tomes.map(e=>e.id),i:E.items.map(e=>e.id)};let t;e.c||delete e.c,e.w||delete e.w,e.t&&0!==e.t.length||delete e.t,e.i&&0!==e.i.length||delete e.i;try{t=btoa(JSON.stringify(e))}catch(i){return d.error({operation:"build.share",error:{name:i.name,message:i.message,module:"build-planner"}}),void c.error("Build is too large to share. Try removing some items.")}const a=`${window.location.origin}${window.location.pathname}#build=${t}`;d.info({operation:"build.share",data:{action:"share_url",characterId:E.character?.id,weaponId:E.weapon?.id,tomesCount:E.tomes?.length??0,itemsCount:E.items?.length??0}}),$(a,"Build link copied to clipboard! Share it with friends.")}function V(){const e=window.location.hash;if(!e||!e.includes("build="))return!1;try{const t=e.split("build=")[1];if(!t)return c.error("Invalid build link"),!1;if(!function(e){return/^[A-Za-z0-9+/=]+$/.test(e)}(t))return d.warn({operation:"build.load",error:{name:"ValidationError",message:"Invalid base64 characters in build URL"}}),c.error("Invalid build link format"),!1;if(t.length>1e4)return d.warn({operation:"build.load",error:{name:"ValidationError",message:"Build URL exceeds maximum length"}}),c.error("Build link is too long"),!1;let a;try{a=atob(t)}catch{return c.error("Invalid build link encoding"),!1}const i=JSON.parse(a);if(!function(e){if("object"!=typeof e||null===e)return!1;const t=e;return!(void 0!==t.c&&"string"!=typeof t.c||void 0!==t.w&&"string"!=typeof t.w||!(void 0===t.t||Array.isArray(t.t)&&t.t.every(e=>"string"==typeof e))||!(void 0===t.i||Array.isArray(t.i)&&t.i.every(e=>"string"==typeof e)))}(i))return c.error("Invalid build data format"),!1;if(i.c&&n.characters){const e=new Map(n.characters.characters.map(e=>[e.id,e])).get(i.c);e&&(E.character=e,b(e.id))}if(i.w&&n.weapons){const e=new Map(n.weapons.weapons.map(e=>[e.id,e])).get(i.w);e&&(E.weapon=e,y(e.id))}if(i.t&&Array.isArray(i.t)&&n.tomes?.tomes){const e=new Map(n.tomes.tomes.map(e=>[e.id,e]));E.tomes=i.t.map(t=>e.get(t)).filter(e=>void 0!==e),_(i.t)}if(i.i&&Array.isArray(i.i)&&n.items?.items){const e=new Map(n.items.items.map(e=>[e.id,e]));E.items=i.i.map(t=>e.get(t)).filter(e=>void 0!==e),k(i.i)}return R(),d.info({operation:"build.load",data:{action:"load_from_url",source:"url",characterId:E.character?.id,weaponId:E.weapon?.id,tomesCount:E.tomes?.length??0,itemsCount:E.items?.length??0}}),c.success("Build loaded from URL!"),!0}catch{return c.error("Invalid build link"),!1}}function G(){if(!E.character&&!E.weapon&&0===(E.tomes?.length??0)&&0===(E.items?.length??0))return void(window.location.hash&&history.replaceState(null,"",window.location.pathname));const e={c:E.character?.id,w:E.weapon?.id,t:E.tomes.map(e=>e.id),i:E.items.map(e=>e.id)};e.c||delete e.c,e.w||delete e.w,e.t&&0!==e.t.length||delete e.t,e.i&&0!==e.i.length||delete e.i;try{const t=btoa(JSON.stringify(e));history.replaceState(null,"",`#build=${t}`)}catch(t){d.debug({operation:"build.url_update",error:{name:t.name,message:t.message}})}}function U(){d.info({operation:"build.clear",data:{action:"clear",hadCharacter:null!==E.character,hadWeapon:null!==E.weapon,tomesCleared:E.tomes?.length??0,itemsCleared:E.items?.length??0}}),v(),l("currentBuild",{character:null,weapon:null,tomes:[],items:[]}),s("build-character",""),s("build-weapon",""),r(".tome-checkbox").forEach(e=>e.checked=!1),r(".item-checkbox").forEach(e=>e.checked=!1),R()}function q(){const e=m("currentBuild");return{...e,tomes:[...e.tomes],items:[...e.items]}}export{C as BUILD_TEMPLATES,j as applyRandomBuild,x as calculateBuildStats,U as clearBuild,T as clearBuildHistory,L as deleteBuildFromHistory,P as exportBuild,A as getBuildHistory,q as getCurrentBuild,D as importBuild,v as invalidateBuildStatsCache,N as loadBuildFromData,I as loadBuildFromHistory,V as loadBuildFromURL,H as loadBuildTemplate,O as renderBuildPlanner,F as saveBuildToHistory,J as setupBuildPlannerEvents,z as shareBuildURL,R as updateBuildAnalysis,G as updateBuildURL};
//# sourceMappingURL=build-planner-DdNX5Mcx.js.map
